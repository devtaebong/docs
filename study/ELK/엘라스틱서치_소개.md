# 엘라스틱서치 소개

## 개요

엘라스틱서치(Elastic Search)는 아파치 루씬(Lucene)을 기반으로 동작하는 **분산검색엔진**이며, 현재 검색엔진 분야에서 각광받고 있는 시스템 중 하나이다.

특히 데이터 수집 및 시각화를 엘라스틱스택 내에서 한번에 처리할 수 있다는 것이 큰 장점이다.

또한 JSON 기반의 문서를 저장, 인덱싱, 검색하기 때문에 NoSQL 스토리지의 성격도 가지고 있다. 강력한 전문 검색 기능을 제공하는 NoSQL 스토리지로서 포지셔닝이 엘라스팅서치의 가장 큰 장점이다.

## 엘라스틱 서치 특징

루씬은 데이터를 인덱싱하고 검색하는 기능을 제공하는 검색 엔진의 코어 라이브러이이다. 엘라스틱서치는 루씬을 코어로 이용하여 JSON 문서의 저장, 인덱싱, 검색 등의 작업을 분산처리하는 검색 엔진이다.

### 검색엔진

- 엘라스틱서치는 검색엔진이다. 따라서 다른 DBMS나 NoSQL에 비해 강력한 검색 기능을 지원한다. 
- 단순 텍스트 매칭이 아닌 전문검색(full-text-search)이 가능하며 다양한 종류의 검색 쿼리를 지원한다. 
- 역색인을 사용하기 때문에 검색속도가 매우 빠르다.
- 형태소 분석이 가능하다.
- 다양한 애널라이저(analyzer)를 조합하여 복잡한 비즈니스 요구사항에 맞는 인덱스를 구성할 수 있따. 

### 분산처리

- 데이터를 여러 노드에 분산시켜서 저장이 가능하고 검색이나 집계 작업 등을 수행할 때에도 분산처리가 가능하다.

### 고가용성

- 클러스터를 구성하고 있는 일부 노드에 장애가 발생해도 만들어 놓은 복제본 데이터를 이용해서 중단 없이 서비스를 지속할 수 있다.
- 복제본이 마스터로 승격되면 새로운 복제본을 만들어서 복제본의 개수를 유지시킨다.
- 결과적으로 노드 간 데이터 균형을 자동으로 맞추는 기능을 제공한다.

### 확장성

- 더 많은 처리 능력이 필요할 때는 새로운 노드에 엘라스틱서치를 설치해서 클러스터에 참여시키기만 하면 된다.
- 새 노드에 데이터를 복제하거나 옮기는 작업도 자동으로 처리된다.

### Rest API 기반으로 동작

- 엘라스틱서치는 JSON 형태의 데이터를 다룬다. 엘라스틱서치에 작업 요청을 보낼 때도 JSON 기반의 REST API를 사용한다.
- 결과적으로 특별한 클라이언트나 솔루션을 설치하지 않고 사용할 수 있고, 운영체제 등 환경에 독립적으로 HTTP를 통해 쉽게 이용할 수 있다.

### 데이터 안정성

- 데이터 인덱싱 이후 200OK를 받았다면 그 데이터가 디스크에 저장됨을 보장한다. 

### 다양한 플러그인 제공

- 엘라스틱 서치는 다양한 플러그인을 사용해서 기능을 확장하고 변경할 수 있다.
- 엘라스틱서치의 핵심적인 기능들도 플러그인을 통해 제어할 수 있다.
- 엘라스틱에서 공식적으로 지원하는 플러그인이 존재하며, 커뮤니티에서도 다양한 서드파티 플러그인을 제공하고 있다. 


### 준실시간 검색

- 엘라스틱서치는 준실시간 검색(near real-time search)를 제공한다.
- 엘라스틱서치에 데이터를 색인하면 엘라스틱서치가 역색인을 구성하고 이 역색인으로 부터 검색이 가능해지기까지 시간이 걸리기 때문에 데이터 색인 직후 검색 요청은 성공하지 못할 가능성이 높다.

### 트랜잭션 지원 안함

- 엘라스틱서치는 RDBMS와 다르게 트랜잭션을 지원하지 않는다.


### 조인 지원 안함

- `join`이라는 데이터 타입이 있지만 거의 사용되지 않으며 성능도 떨어진다.
- 따라서 데이터를 비정규화해야한다.

## 설치 및 설정

### 설치

```shell
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.2-darwin-aarch64.tar.gz
```

### 설정

config/elasticsearch.yml: 클러스터 정보, 노드 정보, 데이터 파일을 저장할 경로 등 엘라스틱서치의 핵심 설정을 정의한다.
config/jvm.options: 힙 사이즈나 GC 옵션, 힙 덤프 등 JVM 설정을 정의한다.
config/log4j2.properties: log4j2 로깅 관련 설정을 정의한다.

> 엘라스틱서치를 실행하려면 config/elasticsearch.yml는 필수로 작성해야한다. 

#### config/elasticsearch.yml

```yml
cluster.name: test-es
node.name: test-es-node01

path:
    data: /Users/taehyeon/elasticsearch-8.4.2/data
    logs: /Users/taehyeon/elasticsearch-8.4.2/log

network.host: 127.0.0.1

discovery.type: "single-node"
xpack.security.enabled: false
```

- cluster.name: 클러스터의 이름을 지정한다. 이 이름을 기준으로 클러스터가 구성된다.
- node.name: 노드의 이름을 지정한다. 노드의 이름은 클러스터 내에서 고유해야한다.
- path.log: 로그를 저장할 경로를 지정한다.
- path.data: 엘라스틱서치의 데이터를 저장할 경로를 지정한다. 엘라스틱서치가 저장할 문서 내용이나 역색인, 클러스터 설정 등 다양한 데이터를 저장한다. 둘 이상의 경로로 지정할 수도 있다.
- network.host: 엘라스틱서치와 바인딩 될 네트워크 주소를 입력한다. 단일 노드의 개발 모드로 설정할 예정이기 때문에 localhost로 지정한다. 이 설정을 루프백 주소이기 때문에 지정하지 않아도 된다. 다만, 클러스터를 구성할 때에는 루프백이 아닌 값을 지정해야한다.
- discovery.type: 이 값을 single-node로 지정하면 엘라스틱서치는 단일 노드의 개발 모드로 동작하여, 다른 노드의 클러스터 참가 신청을 받아들이지 않는다.
- xpack.security.enabled: 엘라스틱서치에서 제공하는 보안 기능을 사용할 것인지에 대한 내용이다. 이 값을 true로 설정하면 노드간 TLS 통신, 유저와 역할을 기반으로 한 인증과 권한 불리, 감사 증적 등의 기능이 제공된다.

### 실행

```shell
bin/elasticsearch
```

#### 요청

```bash
curl -XGET http://localhost:9200
```

```json
{
  "name" : "test-es-node01",
  "cluster_name" : "test-es",
  "cluster_uuid" : "9w07P5tsQseg0V1ABm8mKA",
  "version" : {
    "number" : "8.4.2",
    "build_flavor" : "default",
    "build_type" : "tar",
    "build_hash" : "89f8c6d8429db93b816403ee75e5c270b43a940a",
    "build_date" : "2022-09-14T16:26:04.382547801Z",
    "build_snapshot" : false,
    "lucene_version" : "9.3.0",
    "minimum_wire_compatibility_version" : "7.17.0",
    "minimum_index_compatibility_version" : "7.0.0"
  },
  "tagline" : "You Know, for Search"
}
```